Module("runtime/nabl/query",[Imports([Import("runtime/nabl/uri"),Import("runtime/nabl/entries"),Import("runtime/index/query")]),Rules([RDefNoArgs("nabl-get-all-definitions",Rule(Var(ListVar("contains-uri*")),App(Call(SVar("mapconcat"),[Call(SVar("nabl-get-unique-nonunique"),[Build(NoAnnoList(Op("Def",[RootApp(Id)])))])]),Var(ListVar("uri*"))),Assign(Var(ListVar("uri*")),App(CallNoArgs(SVar("nabl-uris")),Var(ListVar("contains-uri*")))))),RDefT("nabl-get-child-definitions",[],[DefaultVarDec("ns")],Rule(Var(ListVar("contains-uri*")),NoAnnoList(List([Var(ListVar("def*")),Var(ListVar("alias-def*"))])),Seq(Assign(Var(ListVar("uri*")),App(CallNoArgs(SVar("nabl-uris")),Var(ListVar("contains-uri*")))),Seq(Assign(Var(ListVar("def*")),App(Seq(Call(SVar("mapconcat"),[Seq(Build(NoAnnoList(Op("Def",[RootApp(Id)]))),CallT(SVar("nabl-get-children"),[],[Var("ns")]))]),Call(SVar("mapconcat"),[Seq(CallNoArgs(SVar("nabl-uri")),Call(SVar("nabl-get-unique-nonunique"),[Build(NoAnnoList(Op("Def",[RootApp(Id)])))]))])),Var(ListVar("uri*")))),Assign(Var(ListVar("alias-def*")),App(Seq(Call(SVar("mapconcat"),[Seq(Build(NoAnnoList(Op("Alias",[RootApp(Id),NoAnnoList(Tuple([]))]))),CallT(SVar("nabl-get-children"),[],[Var("ns")]))]),Call(SVar("mapconcat"),[Seq(CallNoArgs(SVar("nabl-value")),Seq(Build(NoAnnoList(Op("Def",[RootApp(Id)]))),CallNoArgs(SVar("nabl-get-all-definitions"))))])),Var(ListVar("uri*")))))))),RDefNoArgs("nabl-get-all-uses",Rule(Var("containsURI"),App(CallNoArgs(SVar("nabl-get-all")),NoAnnoList(Op("Use",[Var("uri")]))),Assign(Var("uri"),App(CallNoArgs(SVar("nabl-uri")),Var("containsURI"))))),RDefNoArgs("nabl-get-all-aliases",Rule(Var(ListVar("contains-uri*")),Var(ListVar("alias-uri*")),Seq(Assign(Var(ListVar("uri*")),App(CallNoArgs(SVar("nabl-uris")),Var(ListVar("contains-uri*")))),Seq(Assign(Var(ListVar("nonunique-uri*")),App(Call(SVar("filter"),[CallT(SVar("nabl-replace-uri-qualifier"),[],[NoAnnoList(Op("NonUnique",[]))])]),Var(ListVar("uri*")))),Assign(Var(ListVar("alias-uri*")),App(Call(SVar("mapconcat"),[Seq(Build(NoAnnoList(Op("Alias",[RootApp(Id),NoAnnoList(Tuple([]))]))),CallNoArgs(SVar("nabl-get-all-values")))]),Var(ListVar("nonunique-uri*")))))))),RDefNoArgs("nabl-get-all-inverse-aliasses",Rule(Var(ListVar("contains-uri*")),Var(ListVar("inverse-alias*")),Seq(Assign(Var(ListVar("uri*")),App(CallNoArgs(SVar("nabl-uris")),Var(ListVar("contains-uri*")))),Assign(Var(ListVar("inverse-alias*")),App(Call(SVar("mapconcat"),[Seq(Build(NoAnnoList(Op("InverseAlias",[RootApp(Id),NoAnnoList(Tuple([]))]))),CallNoArgs(SVar("nabl-get-all-values")))]),Var(ListVar("uri*")))))))]),Rules([RDefNoArgs("nabl-get-all",RuleNoCond(Var("template"),App(CallNoArgs(SVar("index-get-all")),Var("template")))),RDefNoArgs("nabl-get-all-values",RuleNoCond(Var("template"),App(Seq(CallNoArgs(SVar("nabl-get-all")),Call(SVar("map"),[CallNoArgs(SVar("nabl-value"))])),Var("template")))),RDefNoArgs("nabl-get",RuleNoCond(Var("template"),App(Seq(CallNoArgs(SVar("nabl-get-all")),CallNoArgs(SVar("Hd"))),Var("template")))),RDefNoArgs("nabl-get-value",RuleNoCond(Var("template"),App(Seq(CallNoArgs(SVar("nabl-get-all")),Seq(CallNoArgs(SVar("Hd")),CallNoArgs(SVar("nabl-value")))),Var("template")))),RDefNoArgs("nabl-get-children",Rule(Var("template"),Var("entries"),[WithClause(Assign(Var("entries"),App(CallNoArgs(SVar("index-get-children")),Var("template"))))])),RDefT("nabl-get-children",[],[DefaultVarDec("namespace")],Rule(Var("template"),Var("entries"),[WithClause(Seq(Assign(Var("children"),App(CallNoArgs(SVar("index-get-children")),Var("template"))),Assign(Var("entries"),App(CallT(SVar("nabl-filter-entries"),[],[Var("namespace")]),Var("children")))))])),RDefT("nabl-get-children",[],[DefaultVarDec("namespace"),DefaultVarDec("prefix")],Rule(Var("template"),Var("entries"),[WithClause(Seq(Assign(Var("children"),App(CallNoArgs(SVar("index-get-children")),Var("template"))),Assign(Var("entries"),App(CallT(SVar("nabl-filter-entries"),[],[Var("namespace"),Var("prefix")]),Var("children")))))])),RDef("nabl-get-unique-nonunique",[DefaultVarDec("create-template")],Rule(Var("uri"),NoAnnoList(List([Var(ListVar("unique*")),Var(ListVar("nonUnique*"))])),Seq(CondChoice(Assign(Var(ListVar("alias*")),App(CallNoArgs(SVar("nabl-get-all-aliases")),Var("uri"))),Assign(Var(ListVar("unique*")),App(Call(SVar("mapconcat"),[Seq(CallNoArgs(SVar("create-template")),CallNoArgs(SVar("nabl-get-all")))]),Var(ListVar("alias*")))),Assign(Var(ListVar("unique*")),NoAnnoList(List([])))),CondChoice(Assign(Var("nonUniqueURI"),App(CallT(SVar("nabl-replace-uri-qualifier"),[],[NoAnnoList(Op("NonUnique",[]))]),Var("uri"))),Assign(Var(ListVar("nonUnique*")),App(Seq(CallNoArgs(SVar("create-template")),CallNoArgs(SVar("nabl-get-all"))),Var("nonUniqueURI"))),Assign(Var(ListVar("nonUnique*")),NoAnnoList(List([])))))))]),Rules([RDefT("nabl-filter-entries",[],[DefaultVarDec("namespace"),DefaultVarDec("prefix")],RuleNoCond(Var(ListVar("entry*")),App(Call(SVar("filter"),[CallT(SVar("nabl-compare-prefix"),[],[Var("namespace"),Var("prefix")])]),Var(ListVar("entry*"))))),RDefT("nabl-filter-entries",[],[DefaultVarDec("namespace")],RuleNoCond(Var(ListVar("entry*")),App(Call(SVar("filter"),[CallT(SVar("nabl-compare-namespace"),[],[Var("namespace")])]),Var(ListVar("entry*")))))]),Rules([RDefT("nabl-compare-prefix",[],[DefaultVarDec("namespace"),DefaultVarDec("prefix")],Rule(Var("entry"),RootApp(Id),Seq(Assign(Var("uri"),App(CallNoArgs(SVar("nabl-uri")),Var("entry"))),Seq(BA(CallNoArgs(SVar("eq")),NoAnnoList(Tuple([Var("namespace"),App(CallNoArgs(SVar("nabl-uri-namespace")),Var("uri"))]))),BA(Call(SVar("is-substring"),[Build(Var("prefix"))]),App(CallNoArgs(SVar("nabl-uri-name")),Var("uri"))))))),RDefT("nabl-compare-namespace",[],[DefaultVarDec("namespace")],Rule(Var("entry"),RootApp(Id),Seq(Assign(Var("uri"),App(CallNoArgs(SVar("nabl-uri")),Var("entry"))),BA(CallNoArgs(SVar("eq")),NoAnnoList(Tuple([Var("namespace"),App(CallNoArgs(SVar("nabl-uri-namespace")),Var("uri"))]))))))])])